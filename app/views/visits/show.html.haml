%nav.config-breadcrumb.z-depth-0
  .nav-wrapper
    .row
      .col.s12.m12.l12
        =link_to 'Visitas',root_path, class:'breadcrumb'
        %a.breadcrumb
          =@visit.institution
.row
  .col.s12.m12
    .card
      .card-content
        .card-title
          Información de la visita
          = link_to edit_visit_path(@visit), class:'right btn-floating tooltipped blue', 'data-tooltip':'Editar', 'data-position':'right' do
            %i.material-icons edit
        %p
          %b Departamento:
          = @visit.department.name
        %p
          %b Institución:
          = @visit.institution
        %p
          %b Nombre del responsable:
          = @visit.resp_name
        %p
          %b Teléfono del responsable:
          = @visit.resp_phone
        %p
          %b Correo del responsable:
          = @visit.resp_email
        %p
          %b Tipo de transporte:
          = @visit.get_transport_type
        %p
          %b Fecha:
          = fdate(@visit.date)


.row
  .col.s12.m12
    .card
      .card-content
        .card-title
          Visitas a laboratorios
          %button.btn-floating.green.darken-2.tooltipped.right{'data-tooltip':'Agregar visita a laboratorio','data-position':'right', onclick:"openModal($('#new_room_visit_modal'));"}
            %i.material-icons add
        -if @room_visits.size > 0
          %table.bordered.highlight.responsive-table
            %thead
              %tr
                %th
                %th Laboratorio
                %th Guía
                %th Hora
                %th Estatus
            %tbody
              -@room_visits.order('date ASC').each do |room_visit|
                %tr.tr-click{onclick:"openEditRoomVisitModal(#{room_visit.id});"}
                  %td
                    %img.room-visit-icon.circle{src:"http://cimav.edu.mx/foto/#{room_visit.persona.cuenta_cimav}"}
                  %td
                    =room_visit.room.name
                  %td
                    =room_visit.persona.full_name rescue ''
                  %td
                    =ftime room_visit.date rescue ''
                  %td
                    =room_visit.get_status
        -else
          %blockquote
            Aun no hay visitas a laboratorio

#new_room_visit_modal.modal
  .modal-content
    .center
      %h4 Nueva visita a laboratorio
    =render 'form_room_visit', room_visit: RoomVisit.new, screen:'new', time:'', url:"/visits/#{@visit.id}/create_room_visit"


#edit_room_visit_modal.modal
  .modal-content
    %h4.center Editar visita a laboratorio
    .center-align
      #edit_room_visit_preloader.preloader-wrapper.big.active
        .spinner-layer.spinner-blue-only
          .circle-clipper.left
            .circle
          .gap-patch
            .circle
          .circle-clipper.right
            .circle

    #edit_room_visit_content

:javascript
  Turbolinks.clearCache();